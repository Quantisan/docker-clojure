# docker-clojure

This is the repository for the [official Docker image for Clojure](https://registry.hub.docker.com/_/clojure/).
It is automatically pulled and built by Stackbrew into the Docker registry.
This image runs on OpenJDK 8, 11, and more recent releases and includes [Leiningen](http://leiningen.org),
[boot](http://boot-clj.com), and/or [tools-deps](https://clojure.org/reference/deps_and_cli)
(see below for tags and building instructions).

## Leiningen vs. boot vs. tools-deps

The version tags on these images look like `(temurin-major-version-)lein-N.N.N(-distro)`,
`(temurin-major-version-)boot-N.N.N(-distro)`, and `(temurin-major-version-)tools-deps(-distro)`.
These refer to which version of leiningen, boot, or tools-deps is packaged in the image (because they can then install
and use any version of Clojure at runtime). The `lein` (or `lein-slim-bullseye`, `temurin-17-lein`, etc.)
images will always have a recent version of leiningen installed. If you want boot, specify either `clojure:boot`,
`clojure:boot-slim-bullseye`, or `clojure:boot-N.N.N`, `clojure:boot-N.N.N-slim-bullseye`,
`clojure:temurin-17-boot-N.N.N-slim-bullseye`, etc. (where `N.N.N` is the version of boot you want installed). If
you want to use tools-deps, specify either `clojure:tools-deps`, `clojure:tools-deps-slim-bullseye` or other similar
variants.

### Note about the latest tag

As of 2020-3-20 the `clojure:latest` (also `clojure` because `latest` is the default) now has leiningen, boot, and
tools-deps installed.

Previously this tag only had leiningen installed. Installing the others is helpful for quick start examples, newcomers,
etc. as leiningen is by no means the de facto standard build tool these days. The downside is that the image is larger.
But for the `latest` tag it's a good trade-off because for anything real we have always recommended using more specific
tags. No other tags are affected by this change.

## JDK versions

Java follows a release cadence of every 6 months with an LTS (long-term support) release every 3 years.
As of 2019-9-25, our images will default to the latest LTS release of OpenJDK (currently 17). But we also now provide
the ability to specify which version of Java you'd like via Docker tags:

JDK 1.8 tools-deps image: `clojure:openjdk-8-tools-deps`
JDK 11 variant of that image: `clojure:openjdk-11-tools-deps` or `clojure:tool-deps`
JDK 17 with the latest release of leiningen: `clojure:temurin-17`
JDK 18 with boot 2.8.3: `clojure:temurin-18-boot-2.8.3`

## Linux distro

The upstream openjdk (java versions 11 and below) and eclipse-temurin
(java versions 17+) images are built on a few different variants of Debian
Linux or Ubuntu (respectively), so we have exposed those in our Docker tags as
well. The defaults are now Debian slim-bullseye and Ubuntu focal.
But you can also specify which distro you'd like by appending it to the end of
your Docker tag as in the following examples (but note that not every
combination is provided upstream and thus likewise for us):

Java 8 leiningen on Debian slim-bullseye: `clojure:openjdk-8` or `clojure:openjdk-8-lein` or `clojure:openjdk-8-lein-bullseye`
Java 11 leiningen on Debian buster: `clojure:openjdk-11-bullseye` or `clojure:openjdk-11-lein-bullseye`
Java 17 tools-deps on Ubuntu focal: `clojure:tools-deps` or `clojure:temurin-17-tools-deps` or `clojure:temurin-17-tools-deps-focal`

### Alpine Linux

Sometimes there are upstream openjdk or eclipse-temurin images based on Alpine
Linux.

As of 2022-4-29 these are available for linux/amd64 only.

Some example tags:

Java 17 leiningen on Alpine: `clojure:temurin-17-alpine` `clojure:temurin-17-lein-alpine`
Java 18 tools-deps on Alpine: `clojure:temurin-18-tools-deps-alpine`

### `clojure:slim-buster` / `clojure:slim-bullseye`

These images are based on the Debian buster distribution but have fewer
packages installed and are thus a bit smaller than the `buster` or `bullseye`
images. Their use is recommended.

Note that as of 2022-4-29 there are no `slim-focal` images published by the
eclipse-temurin maintainers, so the slim option there is the `alpine` variant.

## Examples

### Interactive Shell

Run an interactive shell from this image.

```
docker run -i -t clojure /bin/bash
```

Then within the shell, create a new Leiningen project and start a Clojure REPL.

```
lein new hello-world
cd hello-world
lein repl
```

## Builds

The Dockerfiles are generated by the `docker-clojure` Clojure app in this repo.

You'll need the `tools-deps` distribution of Clojure installed to run the
build. Often this just means installing the `clojure` package for your system. 

The `./build-images.sh` script will generate the Dockerfiles and build all of the images.

### buildx

Note that you'll need to enable the new `buildx` feature and set as the default
builder in the Docker daemon you're using to build the images. The build script
uses some flags that require it.

You'll also need to create a builder container with `docker buildx create --use`
in order to build images for all supported platforms (currently linux/amd64 and
linux/arm64).

[Read the docs here](https://docs.docker.com/buildx/working-with-buildx/) for more info.

## Tests

The `docker-clojure` build tool has a test suite that can be run via the
`./test.sh` script. 
